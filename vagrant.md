# mission2021
2021년에 공부한 내용들을 문서로 저장하는 곳.
# 1. vagrant (2021.01.04 ~ 2021.01.10)
* 베이그런트는 가상화 소프트웨어 (버추얼박스, 도커 컨테이너, AWS 등)의 생성 및 유지보수를 위한 오픈소스 소프트웨어 제품
* 루비 언어로 작성됨
* Provision : 게스트 머신을 반복적으로 생성하고 사용하기 위해 프로비져닝으로 만들어서 사용
* Vagrant.configure("2") 의 의미
```
Vagrant.configure("2") do |config|
  # ...
end
```
  + 여기서, configure("2")는 버전을 의미함.
  + 최근에는 "1", "2" 두 가지 버전만을 지원하며, 버전 1의 경우 Vagrant 1.0.x 버전을, 버전 2의 경우엔 1.1+ ~ 2.0.x 버전을 나타낸다.
  + 또한, 버전별로 지원하는 configuration이 다름. 그렇기 때문에, 부득이하게 버전 1과 2의 configuration을 사용해야 한다면 다음과 같이 사용해야 함.
```
Vagrant.configure("1") do |config|
  # v1 configs...
end

Vagrant.configure("2") do |config|
  # v2 configs...
end
```
나머지 버전에 관한 정보 : https://www.vagrantup.com/docs/vagrantfile/version

## 작업 LIST
### 1. Box로 VM 생성하기 (CentOS, Ubuntu 등)
* 방법1) vagrant init bento/centos-7.4 명령어로 Vagrantfile을 생성 후 생성된 파일에 다음의 내용 작성 (Vagrantfile 위치는 처음 Vagrant를 설치한 위치)
```
Vagrant.configure("2") do |config|
  config.vm.box = "bento/centos-7.2"
  config.vm.box_version = "2.3.1"
end
```
(여기서 init 파일은 VM을 구동하기 위한 메타데이터 정보를 가지고 있음)
* 방법2) vagrant가 설치된 디렉토리 상위 폴더에 Vagrantfile을 직접 생성하여 작성
### 2. VM 삭제
```diff
! TODO
```
* 삭제 명령어 : ```vagrant box remove NAME``` 
### 3. VM의 설정 변경
#### CORE & MEMORY 
* 방법1)
1. 일단 box가 실행중이라면, ```vagrant halt``` 명령어를 통해 서버를 내린다.
2. 그리고 기존 Vagrantfile 에 다음의 내용을 작성한다. 
```
Vagrant.configure("2") do |config|

  config.vm.box = "bento/centos-7.2"
  config.vm.provider "virtualbox" do |vb|
     vb.cpus = "4"
     vb.memory = "4096"
  end

end
```
3. ```vagrant up``` 명령어로 서버를 다시 올린다.

  + TIP : 다음의 설정으로 gui 및 name등을 세팅할 수 있다. 
```diff
! TODO
```
```
config.vm.provider "virtualbox" do |v|
  v.gui = true 
  # 부팅되면서 gui 환경으로 부팅
  v.name = "my_vm"
  # VirtualBox GUI에서의 name을 세팅할 수 있음
end 
```
* 방법2) ```vagrant reload``` 명령어를 통해서도 Vagrantfile 수정 후 서버를 다시 올릴 수 있다.
(주의사항 : Provision의 경우엔 --provision flag 를 사용해 줘야 reload가 됨)

#### DISK (중요)
```diff
! TODO
```
* DISK에는 여러가지 옵션이 있음. (참고 : https://www.vagrantup.com/docs/disks/configuration) *** 정리할 게 좀 많을듯?

* disk types
disk (symbol)
dvd (symbol)
floppy (symbol)

```
config.vm.disk :disk, name: "backup", size: "10GB"
config.vm.disk :dvd, name: "installer", path: "./installer.iso"
config.vm.disk :floppy, name: "cool_files"
```


### 4. 포트 포워딩
```diff
! TODO
```

### 5. SSH 접속
 * SSH 접속 Command : ```vagrant ssh``` 

### 6. GITLAB 설치
```diff
! TODO
```
### 7. VM과 로컬 PC의 디렉토리 공유
```diff
! TODO
```
```
Vagrant.configure("2") do |config|
  # other config here

  config.vm.synced_folder "src/", "/srv/website"
  # host 파일경로, guest 파일경로
end
```
* 여기서 host는 local 디렉토리, guest는 VM 디렉토리를 의미함.
* 이외의 추가적인 옵션은 https://www.vagrantup.com/docs/synced-folders/basic_usage 를 확인
### 8. 네트워크 설정 변경
#### Private IP 설정
```diff
! TODO
```
```
Vagrant.configure("2") do |config|
  config.vm.network "private_network", type: "dhcp"
end
```
```
Vagrant.configure("2") do |config|
  config.vm.network "private_network", ip: "192.168.50.4"
end
```
#### DHCP 설정 (public)
```diff
! TODO
```
```
Vagrant.configure("2") do |config|
  config.vm.network "public_network",
    use_dhcp_assigned_default_route: true
end
```
### 9. Plugin 설치 및 사용
```diff
! TODO
```
```
# Installing a plugin from a known gem source
$ vagrant plugin install my-plugin

# Installing a plugin from a local file source
$ vagrant plugin install /path/to/my-plugin.gem

# Usage plugin
# 플러그인의 사용법에 따라 달라질 수 있음
# (provisioners should be available via config.vm.provision, etc.)

# Removing a plugin from a known gem source
$ vagrant plugin uninstall my-plugin

# Updating plugin
$ vagrant plugin update NAME

# Listing plugin
$ vagrant plugin list
```

Note: In the future, the ```vagrant plugin``` command will include a subcommand that will document the components that each plugin installs.

### 10. 기존 Box로 자체 신규 Box 만들기
```diff
! TODO
```
* Linked clones are based on a master VM, which is generated by importing the base box only once the first time it is required. For the linked clones only differencing disk images are created where the parent disk image belongs to the master VM.
* master VM을 기준으로 기존 밗

```
config.vm.provider "virtualbox" do |v|
  v.linked_clone = true
end
```

### 11. 신규 Box 파일을 웹 서버에 올려놓고 자체 Box 서버를 통해 Box 파일 내려받기
```diff
! TODO
```

*참고 : 코드 색상표
```diff
- text in red
+ text in green
! text in orange
# text in gray
```
