# Nexus Repository
- Nexus Repository 란 ? maven에서 사용할 수 있는 오픈소스 repository 

## Vagrant + CentOS 7에서 Nexus Repository Server 설치

### 패키지 다운로드
- Windows command 창에 ``` vagrant up ``` 명령어 실행 후 ```vagrant ssh``` 명령어로 shell 실행
- 설치할 목록은 https://help.sonatype.com/repomanager3/download/download-archives---repository-manager-3 를 참고
- 설치 과정은 https://help.sonatype.com/repomanager3/installation 를 참고
- 설치 이전에 jdk 1.8 버전이 설치되어 있어야 합니다.

- 설치 및 디렉토리 변경
```
# nexus repository 패키지 설치
$ wget install https://download.sonatype.com/nexus/3/latest-unix.tar.gz   --no-check-certificate
# 설치 후 압축 해제
$ tar -xvf latest-unix.tar.gz
# 압축 해제한 파일을 /opt 디렉토리 밑에 옮김
$ sudo mv nexus-3.29.2-02 /opt/
```
- port 변경
```
$ cd /opt/nexus-3.29.2-02/etc  
$ vi nexus-default.properties
```
![image](https://user-images.githubusercontent.com/57924258/105713708-c9139380-5f5e-11eb-8856-0153864721d5.png)

- 외부에서 사용해야 할 경우
  - 방화벽 오픈
```
firewall-cmd --permanent --zone=public --add-port=8082/tcp
firewall-cmd --reload
firewall-cmd --permanent --list-all
```

### nexus 계정정보 등록 및 nexus 계정 생성
```
sudo groupadd nexus && adduser nexus -g nexus
패스워드 정보도
```
- ```vi /opt/nexus-3.29.2-02/bin/nexus``` 실행  
``` RUN_AS_USER ``` 항목에 nexus 계정 등록


### 서비스 등록해서 자동 실행 시키기
- 다음의 명령어를 입력하여 리눅스 서비스에 등록

```
sudo vi /etc/systemd/system/nexus.service
```
```
[Unit]
Description=nexus service
After=network.target
  
[Service]
Type=forking
LimitNOFILE=65536
ExecStart=/opt/nexus-3.15.2-01/bin/nexus start
ExecStop=/opt/nexus-3.15.2-01/bin/nexus stop
User=nexus
Restart=on-abort
TimeoutSec=600
  
[Install]
WantedBy=multi-user.target
```
```
sudo systemctl daemon-reload
sudo systemctl enable nexus.service
sudo systemctl start nexus.service
```
log는 ```tail -f /opt/sonatype-work/nexus3/log/nexus.log```를 참고하면 됨  
- 서비스 실행 후 커맨드 창
```
-------------------------------------------------

Started Sonatype Nexus OSS 3.29.2-02

-------------------------------------------------
```

- 접속
http://도메인:포트번호/ 화면을 통해 접속 

![image](https://user-images.githubusercontent.com/57924258/105860784-4dcee200-6031-11eb-9edc-1ab01176bc8b.png)

## Spring 등의 외부 Repository를 Nexus에 등록

1. 먼저 UI에서 Blob Stores에 저장 될 저장소를 만든다. (test로 만듦)
2. 만든 후 설정-Repository 메뉴로 들어가 새로운 Repository를 생성한다.

![nexus-repositories-1](https://user-images.githubusercontent.com/57924258/106151653-eabf8580-61bf-11eb-8f16-192f08aa3a80.JPG)
![nexus-repositories-3](https://user-images.githubusercontent.com/57924258/106151658-ebf0b280-61bf-11eb-9fc3-dcb77ae14e56.JPG)
![repo-1](https://user-images.githubusercontent.com/57924258/106152823-36266380-61c1-11eb-8d0c-bf4f415e434e.JPG)
![repo-2](https://user-images.githubusercontent.com/57924258/106152826-37f02700-61c1-11eb-8b94-5849e9bc6bd5.JPG)


## Maven의 settings.xml 파일 추가하여 설치한 Nexus 서버로 미러링

- C:/user/.m2 폴더에 settings.xml 파일을 추가하여 다음과 같이 내용을 작성한다.
```
<?xml version="1.0" encoding="UTF-8"?>
<settings   xmlns="http://maven.apache.org/SETTINGS/1.0.0"
            xmlns:xsi="http://www.w3.org/2001/XMLSchema-instance"
            xsi:schemaLocation="http://maven.apache.org/SETTINGS/1.0.0 http://maven.apache.org/xsd/settings-1.0.0.xsd">
  <mirrors>
    <mirror>
      <id>Maven Repo</id>
      <name>Maven Repo</name>
      <url>http://[url]/repository/maven-public/</url>
      <mirrorOf>central</mirrorOf>
    </mirror>
  </mirrors>
</settings>
```

## Spring Boot Web 프로젝트 구성
![intelli_1](https://user-images.githubusercontent.com/57924258/106151593-db403c80-61bf-11eb-8760-a5e344092659.JPG)
![intelli_2](https://user-images.githubusercontent.com/57924258/106151608-dda29680-61bf-11eb-8177-bd44abee0fed.JPG)
![intelli_3](https://user-images.githubusercontent.com/57924258/106151613-ded3c380-61bf-11eb-94c2-c5b3d8233e54.JPG)
![intelli_4](https://user-images.githubusercontent.com/57924258/106151616-e004f080-61bf-11eb-8a71-e18e1d66b32b.JPG)
![intelli_5](https://user-images.githubusercontent.com/57924258/106151620-e1ceb400-61bf-11eb-8a5f-e32c523287b8.JPG)
![intelli_6](https://user-images.githubusercontent.com/57924258/106151625-e3987780-61bf-11eb-9470-353b75ad491b.JPG)

## Spring Boot를 빌드하여 Nexus에서 dependency 다운로드하는지 확인
- Maven clean을 돌리면 log 파일을 다음과 같다.
```
"...
[INFO] Scanning for projects...
Downloading from Maven Repo: http://192.168.33.10:8089/repository/maven-public/org/springframework/boot/spring-boot-starter-parent/2.4.2/spring-boot-starter-parent-2.4.2.pom
Downloaded from Maven Repo: http://192.168.33.10:8089/repository/maven-public/org/springframework/boot/spring-boot-starter-parent/2.4.2/spring-boot-starter-parent-2.4.2.pom (0 B at 0 B/s)
Downloading from Maven Repo: http://192.168.33.10:8089/repository/maven-public/org/springframework/boot/spring-boot-dependencies/2.4.2/spring-boot-dependencies-2.4.2.pom
Downloaded from Maven Repo: http://192.168.33.10:8089/repository/maven-public/org/springframework/boot/spring-boot-dependencies/2.4.2/spring-boot-dependencies-2.4.2.pom (0 B at 0 B/s)
Downloading from Maven Repo: http://192.168.33.10:8089/repository/maven-public/com/datastax/oss/java-driver-bom/4.9.0/java-driver-bom-4.9.0.pom
Downloaded from Maven Repo: http://192.168.33.10:8089/repository/maven-public/com/datastax/oss/java-driver-bom/4.9.0/java-driver-bom-4.9.0.pom (0 B at 0 B/s)
Downloading from Maven Repo: http://192.168.33.10:8089/repository/maven-public/io/dropwizard/metrics/metrics-bom/4.1.17/metrics-bom-4.1.17.pom
Downloaded from Maven Repo: http://192.168.33.10:8089/repository/maven-public/io/dropwizard/metrics/metrics-bom/4.1.17/metrics-bom-4.1.17.pom (0 B at 0 B/s)
...
```

## maven deploy 커맨드로 내가 만든 Spring Boot의 빌드한 JAR 파일을 Nexus에 배포하기 (현아님 Space에 사용 가이드 작성하기 → 추후 Maven쪽으로 옮길 예정)

